<div class="dashboard-container">
  <div class="dashboard-header">
    <h1>Dashboard</h1>
    <button mat-icon-button (click)="refresh()" [disabled]="loading()">
      <mat-icon>refresh</mat-icon>
    </button>
  </div>

  @if (loading()) {
    <div class="loading-container">
      <mat-spinner></mat-spinner>
    </div>
  }

  @if (error()) {
    <div class="error-message">
      <mat-icon>error</mat-icon>
      <span>{{ error() }}</span>
    </div>
  }

  @if (statistics() && !loading()) {
    <div class="stats-grid">
      <!-- Total Users Card -->
      <mat-card class="stat-card primary">
        <mat-card-content>
          <div class="stat-icon">
            <mat-icon>people</mat-icon>
          </div>
          <div class="stat-info">
            <h2>{{ statistics()!.totalUsers }}</h2>
            <p>Total Users</p>
          </div>
        </mat-card-content>
      </mat-card>

      <!-- Total Companies Card -->
      <mat-card class="stat-card accent">
        <mat-card-content>
          <div class="stat-icon">
            <mat-icon>business</mat-icon>
          </div>
          <div class="stat-info">
            <h2>{{ statistics()!.totalCompanies }}</h2>
            <p>Total Companies</p>
          </div>
        </mat-card-content>
      </mat-card>

      <!-- Pending Approvals Card -->
      <mat-card class="stat-card warn">
        <mat-card-content>
          <div class="stat-icon">
            <mat-icon>pending_actions</mat-icon>
          </div>
          <div class="stat-info">
            <h2>{{ statistics()!.pendingApprovals }}</h2>
            <p>Pending Approvals</p>
          </div>
        </mat-card-content>
      </mat-card>

      <!-- Active Users Card -->
      <mat-card class="stat-card success">
        <mat-card-content>
          <div class="stat-icon">
            <mat-icon>check_circle</mat-icon>
          </div>
          <div class="stat-info">
            <h2>{{ statistics()!.activeUsers }}</h2>
            <p>Active Users</p>
          </div>
        </mat-card-content>
      </mat-card>
    </div>

    <!-- Detailed Stats Section -->
    <div class="detailed-stats">
      <!-- Users by Role -->
      <mat-card class="detail-card">
        <mat-card-header>
          <mat-card-title>
            <mat-icon>assignment_ind</mat-icon>
            Users by Role
          </mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <div class="role-list">
            @for (role of statistics()!.usersByRole; track role.role) {
              <div class="role-item">
                <span class="role-name">{{ role.role }}</span>
                <span class="role-count">{{ role.count }}</span>
              </div>
            }
          </div>
        </mat-card-content>
      </mat-card>

      <!-- Approvals by Status -->
      <mat-card class="detail-card">
        <mat-card-header>
          <mat-card-title>
            <mat-icon>approval</mat-icon>
            Approvals by Status
          </mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <div class="approval-list">
            @for (approval of statistics()!.approvalsByStatus; track approval.status) {
              <div class="approval-item">
                <span class="approval-status" [class]="approval.status">{{ approval.status }}</span>
                <span class="approval-count">{{ approval.count }}</span>
              </div>
            }
          </div>
        </mat-card-content>
      </mat-card>

      <!-- Recent Activity -->
      <mat-card class="detail-card full-width">
        <mat-card-header>
          <mat-card-title>
            <mat-icon>timeline</mat-icon>
            Recent Activity (Last 7 Days)
          </mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <div class="activity-chart">
            @for (activity of statistics()!.recentActivity; track activity.date) {
              <div class="activity-bar">
                <div class="bar-label">{{ activity.date | date: 'MMM dd' }}</div>
                <div class="bar-container">
                  <div class="bar-fill" [style.width.%]="(activity.count / getMaxActivity()) * 100"></div>
                </div>
                <div class="bar-value">{{ activity.count }}</div>
              </div>
            }
          </div>
        </mat-card-content>
      </mat-card>
    </div>
  }
</div>
